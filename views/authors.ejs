<!DOCTYPE html>
<html>
<head>
    <title>Authors Stats</title>
    <%- include('common/styles') %>
</head>
<body>
    <%- include('common/navbar') %>
    <div style="padding: 0 5%;">
        <h1>Authors Statistics</h1>

    <a href="/authors/new" style="margin-bottom:20px; background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px;">New Author</a>

        <form method="get" action="/authors" style="margin-bottom: 20px;">
            <label for="name">Name:</label>
            <input type="text" name="name" value="<%= filters.name || '' %>">

            <label>Books:</label>
            <input type="number" name="minBooks" placeholder="Min" value="<%= filters.minBooks || '' %>">
            <input type="number" name="maxBooks" placeholder="Max" value="<%= filters.maxBooks || '' %>">

            <label>Avg Score:</label>
            <input type="number" step="0.1" name="minScore" placeholder="Min" value="<%= filters.minScore || '' %>">
            <input type="number" step="0.1" name="maxScore" placeholder="Max" value="<%= filters.maxScore || '' %>">

            <label>Sales:</label>
            <input type="number" name="minSales" placeholder="Min" value="<%= filters.minSales || '' %>">
            <input type="number" name="maxSales" placeholder="Max" value="<%= filters.maxSales || '' %>">

            <label>Reviews:</label>
            <input type="number" name="minReviews" placeholder="Min" value="<%= filters.minReviews || '' %>">
            <input type="number" name="maxReviews" placeholder="Max" value="<%= filters.maxReviews || '' %>">

            <button type="submit">Filter</button>
        </form>

    <table id="authorsTable">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Name</th>
                    <th onclick="sortTable(1)">Books</th>
                    <th onclick="sortTable(2)">Average Score</th>
                    <th onclick="sortTable(3)">Total Sales</th>
                    <th onclick="sortTable(4)">Total Reviews</th>
                    <th style="width:120px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <% authors.forEach(a => { %>
                    <tr>
                        <td><%= a.name %></td>
                        <td><%= a.bookCount %></td>
                        <td><%= a.avgScore %></td>
                        <td><%= a.totalSales %></td>
                        <td><%= a.totalReviews %></td>
                        <td>
                            <% if (a._id) { %>
                                <a href="/authors/<%= a._id %>/edit" style="background-color: #ffc107; color: #333; border: none; padding: 4px 8px; border-radius: 4px; font-size: 13px; margin-right:3px;">Edit</a>
                                <form action="/authors/<%= a._id %>/delete" method="POST" style="display:inline; margin:0;">
                                    <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 13px;" onclick="return confirm('Are you sure you want to delete this author?');">Delete</button>
                                </form>
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>
    <script>
    function sortTable(n) {
        var table = document.getElementById("authorsTable");
        var tbody = table.tBodies[0];
        var rows = Array.from(tbody.rows);
        var dir = table.getAttribute('data-sort-dir-' + n) || 'asc';
        rows.sort(function(a, b) {
            var x = a.cells[n].innerText.trim();
            var y = b.cells[n].innerText.trim();
            var cmp;
            if (!isNaN(parseFloat(x)) && !isNaN(parseFloat(y))) {
                cmp = parseFloat(x) - parseFloat(y);
            } else {
                cmp = x.localeCompare(y);
            }
            return dir === 'asc' ? cmp : -cmp;
        });
        // Remove all rows and re-add sorted
        while (tbody.firstChild) tbody.removeChild(tbody.firstChild);
        rows.forEach(function(row) { tbody.appendChild(row); });
        // Toggle direction for next click
        table.setAttribute('data-sort-dir-' + n, dir === 'asc' ? 'desc' : 'asc');
    }
    </script>
</body>
</html>
